<%= javascript_include_tag "uploadify/swfobject.js", "uploadify/jquery.uploadify.v2.1.4.min.js" %>
<%= stylesheet_link_tag "uploadify" %>
<script type="text/javascript" charset="utf-8">
<%- session_key = ActionController::Base.session_options[:key] -%> 
$(document).ready(function() {
	
  $('#picture_data').click(function(event){
		event.preventDefault();
	}); 
	
	$('#picture_data').uploadify({
  	uploader : '/uploadify/uploadify.swf',
		cancelImg : '/uploadify/cancel.png',
		multi : true,
		auto : true,
  	script : '/admin/pictures',
    onSelectOnce : function(event,data) {
      $('#picture_data').uploadifySettings('scriptData', {
	        '_http_accept': 'application/javascript',
					'format' : 'json',
	        '_method': 'post',
	        '<%= session_key %>' : encodeURIComponent('<%= u cookies[session_key] %>'),
	        'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>'),
          'album_id' : $('#picture_album_id').val(),
          'name' : $('#picture_name').val(),
          'author' : $('#picture_author').val(),
          'type_image' : $('#picture_type_image').val() }
        );
      alert(data.filesSelected + ' files were selected for upload.');
    }
  });
	
	$('#picture_submit').click(function(event){ 
      event.preventDefault(); 
			$('#picture_data').uploadifyUpload(); 
		});
		
});
</script>

